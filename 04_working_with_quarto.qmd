# Reproducible Documents with Quarto

## Overview & definitions

* A `reproducible document` is a file or set of files, typically in a scientific or data-driven context, that includes both the content (text, tables, figures) & [the code or instructions required to generate and update that content]{uublue-bold}.
  * Designed to ensure that others can reproduce the same document, including its data analysis, results, and visualizations, consistently & accurately. 
  * Reproducible documents are essential for transparent & verifiable research, allowing others to verify and build upon the work.

* `Literate programming` is a [coding]{.uured-bold} & [documentation]{.uured-bold} approach where code and explanations are combined in a single document. 
  * Emphasizes clear and understandable code by interleaving human-readable text (explanations, comments, and documentation) with executable code.
  * Fosters better communication and understanding among programmers.


## Literate programming
- Document a program by
  - Writing explanations in a natural language, interspersed with
  - Snippets of code written in a programming language
- Two operations on this file:
  - [Weaving]{.uublue-bold}: Creating a document incorporating the code and its results
  - [Tangling]{.uublue-bold}: Extract the code into a script file for running
- In the R ecosystem, this was first implemented as `Sweave`
  - Use LaTex to provide the mathematical & textual bits (we'll talk about LaTex soon)
  - The code bits are in R
- Superseded by `rmarkdown` and `knitr`
- Superseded by `Quarto` in the both `R` and `Python` ecosystem 
- Integrates with `Jupyter` notebooks using `polyglot` cells


## Reproducible documents

Adapting the *literate programming* method to creating documents

-  Put text and code in the same document, with access to the data from the code
-  Weave the document so that the results of your analysis are incorporated into the document
-  Given the same data and code, you'll create the same document (reproducible)
-  You can look at the source file to see how the results presented are generated
-  Potentially you can use the same source to create many different kinds of outputs

>The main purpose here is to create documents, slides, websites, blogs, books etc.
>
> The code is a means to creating output for these products, rather than just documenting code

## Tool-sets
Reproducible documents are a marriage of natural language text (usually q/ some markup) & a scripting language.

| Toolset           | Natural language text | Scripting language                   | Requirement                 |
|-------------------|-----------------------|--------------------------------------|-----------------------------|
| Sweave            | LaTex              | R                                    | {{< fa brands r-project >}}           |
| Jupyter notebooks | Markdown              | Python, other kernels                | {{< fa brands python >}}              |
| rmarkdown         | Markdown              | R, but can use Python, shell, others | {{< fa brands r-project >}}           |
| Quarto            | Markdown              | R, Python, Julia, Javascript, others | Independent                           |
| | | | |

There are many [other](https://en.wikipedia.org/wiki/Literate_programming#Literate_programming_practices) toolsets as well.



## Programming languages

- Assuming you already have `R`, `Python`, and/or `anaconda` installed on your computer, including the standard packages.
- you will need: 
  - Python or Anaconda
  - R
  - Jupyter
  - Quarto
  - RStudio, VS Code, Antigravity
  - Google Colab can be an alternative
- [Met It](https://www.bu.edu/metit/) will help you to install the necessary packages and libraries for the course.
  

```{=html}
<iframe src="https://www.bu.edu/metit/" width="1000px" height=120px" scrolling="no"></iframe>
```


## Markdown 

[Optional content]{.uugreen-bold}: Either cover quickly or skip, students can review at their pace. As simple as text documents.

### Markdown overview

* Markdown is a lightweight markup language used for formatting plain text, enabling easy conversion to HTML. Popular for web content & documentation due to simplicity.
* `Why is markdown important for programmers?`

:::: {.columns}
::: {.column width="50%"}
- [Documentation]{.uured-bold}: Markdown simplifies code documentation & explanations.
- [Readability]{.uured-bold}: Enhances code readability & comprehension w/ organized formatting.
- [Collaboration]{.uured-bold}: Markdown fosters efficient collaboration through clear communication of ideas and code.
- [Version Control]{.uured-bold}: Markdown files play well with version control systems like Git, tracking changes effectively.
* `README.md` files are generally markdown 
:::

::: {.column width="50%"}
- [Presentation]{.uured-bold}: It allows seamless integration of code, visuals, and text for clearer presentations.
- [Reproducibility]{.uured-bold}: Markdown aids in replicating experiments by combining code and explanations concisely.
- [Portability]{.uured-bold}: Markdown files are platform-independent and easily convertible to various formats, ensuring accessibility.
- [Time Efficiency]{.uured-bold}: Quick and intuitive syntax saves time on formatting, focusing on content creation.
:::
::::


### Markdown fundamentals

* Markdown is very easy to learn!
* Take some time to get familiar with it over the coming days 
* Common uses in Data science 
  * `README.md` files and report generation
  * Well documented coding with `.ipynb`, `.qmd`, or `.rmd`
* The following cheat-sheet summarizes much of the functionality 
  * [markdown cheat-sheet](https://www.markdownguide.org/cheat-sheet/)

### Important Markdown commands  

- [Headers]{.uured-bold}: Create headings with '#' (e.g., '# Header 1' for the largest heading).
- [Emphasis]{.uured-bold}: Use '*' or '_' for italics ('*italic*') and '**' or '__' for bold ('**bold**').
- [Lists]{.uured-bold}: Create ordered (1. Item) and unordered (- Item) lists.
- [Links]{.uured-bold}: Insert links with `[text](URL)`.
- [Images]{.uured-bold}: Embed images with `![alt text](image URL)`.
- [Blockquotes]{.uured-bold}: Quote text with '>' (e.g., '> This is a quote').
- [Inline-Code]{.uured-bold}: Format inline code with backticks (e.g. \`code\`)
- [Code blocks]{.uured-bold}: Multi-line code-blocks use triple backticks e.g. \`\`\`code\`\`\`).
- [Horizontal Rule]{.uured-bold}: Add a horizontal line with '---' or '___'.
- [Tables]{.uured-bold}: Create tables using '|' and '-' (see Markdown table syntax).
- [Escape Characters]{.uured-bold}: Use '\\' to escape special Markdown characters.

## LaTex
[Optional content]{.uugreen-bold}: Either cover quickly or skip, students can review at their pace.

### LaTex Overview 

- LaTex is a typesetting system commonly used for creating documents with complex formatting, such as research papers, theses, and academic articles.
- Uses `plain text` w/ markup commands to define document structure & formatting.
- Focuses on content & structure, allowing users to separate content from presentation.
- Highly customizable, w/ packages & templates available for various document types.
- LaTeX is particularly popular in academia & scientific publishing due to its support for mathematical equations and references.
- Documents are compiled into PDF w/ LaTeX compilers like pdflatex or xelatex.
- LaTeX is free and open-source, compatible with Windows, macOS, and Linux, and widely used in technical and scientific fields.
- We often use `markdown` for document generation rather than LaTex. You `DON'T` have to be a LaTex expert, but, familiarity w/ writing math in LaTex is important


### LaTex Motivation

It's worth learning a little bit of LaTex both for its mathematical typesetting and for its strong formatting capabilities.

It is common for universities and journals and publishers to provide LaTex document classes for typesetting in their preferred manner. 

### Resources

- [LaTex Math for Undergrads](http://tug.ctan.org/info/undergradmath/undergradmath.pdf)
- [Learn LaTex in 30 minutes](https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes)
- [LaTex-Tutorial.com](https://latex-tutorial.com/tutorials/)

### LaTex

-   The strength of LaTex is in its strong separation of content and formatting.
-   The document was written in a computer science-y markup
-   One of its signature capabilities is in typesetting mathematics, leading it to be one of the main tools for authorship in STEM research.
<!-- -   The final document was determined by the `documentclass` designated in the source. -->

:::: {.columns}
::: {.column width="50%"}
![LaTex math for undergrads [[link](http://tug.ctan.org/info/undergradmath/undergradmath.pdf)]](./images/ch04/pdf.png)
:::

::: {.column width="50%"}
![LaTex math for undergrads [[link](http://tug.ctan.org/info/undergradmath/undergradmath.pdf)]](./images/ch04/eqn.png)
:::
::::


### Latex: basic math commands
LaTeX math commands are fundamental for expressing mathematical equations and symbols in documents.

::: {.columns}
::: {.column}
- `$ $`: Enclose mathematical expressions for inline math mode.
- `$$ $$`: Enclose mathematical expressions for non-inline math mode.
- `\begin{equation}  \end{equation}`: Numbered equation w/ label
- `\begin{align}  \end{align}`: Numbered equation array w/ label
- `\frac{numerator}{denominator}`: Display fractions.
- `\sqrt{...}`: Add square roots.
- `\sum`, `\prod`: Generate summation and product symbols.
- `\int`: Insert integral symbols.
:::
::: {.column}
- `\frac{d}{dx}`: Represent derivatives.
- `\lim`: Display limits.
- `\infty`: Represent infinity symbol.
- `\pm`, `\mp`: Add plus-minus and minus-plus symbols.
- `\cdot`, `\times`: Insert multiplication symbols.
- `\frac{\partial}{\partial x}`: Indicate partial derivatives.
- `\left(...\right)`: Automatically size parentheses and brackets.
- `\alpha`, `\beta`, etc.: Use Greek letters.
- `^` and `_`: Superscripts and subscripts, e.g., `x^2` $\rightarrow x^2$ and `a_{ij}` $\rightarrow a_{ij}$.
:::
:::

### LaTex installation {#sec-latex}

Most reproducible document systems require an installation of LaTex on your computer or system. In particular, both RMarkdown and Quarto use it to generate PDF documents.

There are several distributions of LaTex available, including

- [MacTeX](http://tug.org/mactex/) on macOS
- [MiKTeX](http://miktex.org/) or [TeX Live](http://www.tug.org/texlive) on Windows

However, there is a smaller, essential LaTex distribution available through the `tinytex` package, based on the TeX Live distribution

```bash
quarto install tinytex
```

This installation remains local to Quarto, i.e., it doesn't affect other apps on your computer that use TeX. To make this your default TeX installation on your computer, use 

```bash
quarto install tinytex --update-path
```

See the Quarto documentation on [PDF Engines](https://quarto.org/docs/output-formats/pdf-engine.html), and [here](#sec-tools) for other Quarto tools.


## Mathpix: A very useful tool 

* `mathpix`: [https://mathpix.com/](https://mathpix.com/)
* Mathpix is a tool that uses optical character recognition to convert images of handwritten or printed math equations into digital formats, aiding quick integration of math content into documents and applications.
    ![](./images/ch04/2023-08-24-09-24-28.png){width=800}

<!-- * **Demo**: `Run example` -->

## R-Markdown
[Optional content]{.uugreen-bold}: Either cover quickly or skip, students can review at their pace.


### RMarkdown

- [Markdown](https://daringfireball.net/projects/markdown/) is a text-to-HTML conversion tool meant for web writers to write HTML pages without having to deal with all the syntax
    - It allows the use of LaTex for math typesetting :wink: :wink:

- [RMarkdown](https://rmarkdown.rstudio.com) creates a noweb-like system for creating Markdown documents using R
- RMarkdown was preceded by Yihui Xie's `knitr` package, & still has most of its capabilitie
 
:::: {.columns}
::: {.column width="30%"}
![](./images/ch04/rmarkdown.png){width=300}
:::

::: {.column width="70%"}
This is still inspired by `Sweave`

- Text is written in Markdown markup
- Code chunks are delimited by ` ```{r}` in line with Markdown syntax
- A richer set of options for chunks
:::
::::

### Pandoc

- [Pandoc](https://pandoc.org/) is a "universal document converter" that has taken Markdown-based pipelines to a next level by allowing different kinds of outputs

:::: {.columns}
::: {.column width="40%"}
![](./images/ch04/pandoc.png){height=55%}
:::
::: {.column width="60%"}
- Note the breadth of available formats for conversion
- For us, the most useful are 
  - HTML
  - Word/Powerpoint

:::
::::

### RMarkdown document

![Andrew Bray, rstudio::conf(2022)](./images/ch04/paste-00475E59.png)


## RMarkdown

- RMarkdown has a [strong ecosystem](https://rmarkdown.rstudio.com/gallery.html) around it due to its extensibility. 
  - Documents
  - Interactive documents (including dashboards and Shiny apps)
  - Presentations
  - Books (see [bookdown.org](https://www.bookdown.org) for many great R books freely available)
  - Websites
  - Journal templates (using the `rticles` package)


## Jupyter
[Optional content]{.uugreen-bold}: Either cover quickly or skip, students can review at their pace.


### Jupyter Lab & Notebook

:::: {.columns}
::: {.column width="60%"}
[JupyterLab](https://jupyterlab.readthedocs.io/en/stable/) is a web-based interactive user interface

- Like its predecessor, the [Jupyter Notebook](https://jupyter-notebook.readthedocs.io/en/latest/), it runs a [programming language **kernel**](https://github.com/jupyter/jupyter/wiki/Jupyter-kernels) that provides the computational engine for the notebook
    - Wide variety of kernels are available, including R, Julia, SAS, Ruby, Javascript (based on nodejs), Matlab & many, many others ([full list](https://github.com/jupyter/jupyter/wiki/Jupyter-kernels))
- The text part of the ntebook uses Markdown formatting
- One can produce various outputs with JupyterLab using the [nbconvert](https://nbconvert.readthedocs.io/en/latest/) Python package
    - Primary targets are static, like HTML, LaTex, PDF, Markdown, etc
- You can convert set of Jupyter notebooks into an online book w/ [jupyterbook](https://jupyterbook.org/en/stable/intro.html)
    - See examples [here](https://executablebooks.org/en/latest/gallery.html)
:::
::: {.column width="40%"}
![Source: jupyter.org](./images/ch04/jupyter.png)
:::
::::

### Jupyter notebooks are very popular

- Common in Kaggle competitions & common analyses interface w/ literate programming
- Inbuilt into many cloud platforms (Google Colab, DataBricks, AWS Sagemaker)
- Can be read, edited and run directly in VS Code or Pycharm without starting a web service

[... But]{.bloodred-bold}

:::: {.columns}
::: {.column width="30%"}
![](./images/ch04/2egqlc.jpeg){height=350}

:::
::: {.column width="70%"}
<!-- ![](./images/ch04/grus-jupyter.png){width=250} -->

> But some would call this a [red herring]{.bloodred-bold}, since you can always to "Run all cells" in a notebook to do things in the right order
:::
::::


## Quarto

Quarto is the next generation of RMarkdown developed by [Posit](https://www.posit.com)



### Quarto overview 

[Quarto](https://quarto.org/) is a modern publishing system designed for data science and technical communication, focusing on reproducibility, interactivity, and flexibility:

- [Markdown-Based]{.uured-bold}: Utilizes Markdown for writing content, embedding code, and creating interactive documents.
- [Data-Driven]{.uured-bold}: Supports integration of code & data to generate dynamic, up-to-date reports and documents.
- [Reproducibility]{.uured-bold}: Ensures the ability to recreate documents with consistent results using source code and data.
- [Customizable Outputs]{.uured-bold}: Generates various outputs like HTML, PDF, and more, allowing customization for different needs.  
- [Interactive Elements]{.uured-bold}: Enables creation of interactive charts, tables, and visualizations directly within documents.
- [Extensible]{.uured-bold}: Offers extensibility via plugins with tools like R, Python, and Jupyter.

### R vs. RStudio vs. Quarto
:::: {.callout-note}

#### IDEs and Programming Languages

![](./images/ch04/quarto_logo.svg){width=20% fig-align="center"}
::::

:::: {.columns}

::: {.column width=45%}

![](./images/ch04/RStudio_logo.svg){width=30% fig-align="center"}

- GUI wrapper around R
- Run **blocks** of R code (`.qmd` **chunks**)

::: {.callout-note}
[R Language {{< fa brands r-project >}}](https://www.r-project.org/)

- Programming language
- Runs scripts via '*r script.r*' enclosed in single backticks ().
:::
:::

::: {.column width=3%}
### +
:::

::: {.column width=45%}

![](./images/ch04/jupyter_logo.svg){width=30% fig-align="center"}

- GUI wrapper around Python (IDE)
- Run **blocks** of Python code (`.ipynb` **cells**)

```{r}
library(fontawesome)
```

::: {.callout-note}
[Python {{< fa brands python >}}](https://www.python.org/)

- Scripting language
- On its own, just runs scripts via '*python script.py*' enclosed in single backticks ()
:::
:::

::::


## RMarkdown & Quarto

+---------------------------------------------+------------------------------------------------------------------------------+
| rmarkdown                                   | quarto                                                                       |
+=============================================+==============================================================================+
| Requires R                                  | Script-language agnostic (R or Jupyter kernel)                               |
+---------------------------------------------+------------------------------------------------------------------------------+
| Mature ecosystem                            | New kid on the block                                                         |
+---------------------------------------------+------------------------------------------------------------------------------+
| Uses `knitr` for weaving                    | Uses `knitr` or jupyter for weaving                                          |
+---------------------------------------------+------------------------------------------------------------------------------+
| Various engines for creating final document | Uses [pandoc](https://www.pandoc.org) exclusively for document rendering     |
+---------------------------------------------+------------------------------------------------------------------------------+
| Uses more basic markdown                    | Allows more complex HTML structures like div blocks, tabsets, callouts, etc. |
+---------------------------------------------+------------------------------------------------------------------------------+


- RMarkdown documents based on pandoc will render in quarto
    - `xaringan`, a popular presentation package based on RMarkdown, renders directly to `remark.js` and so is **not** compatible with Quarto
- We can now use Jupyter notebooks as a source for Quarto, allowing the production of Python-based documents with the same fidelity as R users experience. 
    - In fact, you can use any available Jupyter kernel for the source Jupyter notebook, not just Python

## RMarkdown & Quarto
::: {.r-stack}
:::{.fragment .fade-left}
![&nbsp;](./images/ch04/paste-0860D360.png){fig-align="center" width="65%"}
:::
:::{.fragment .fade-right}
![&nbsp;](./images/ch04/paste-CC007B93.png){.fragment .fade-left fig-align="center" width="65%"}
:::
:::


## Single source, many outputs 

We can create content (text, code, results, graphics) within a source document, and then use different weaving engines to create different document types

::: {.column width="47%"}
-   Documents
    -   Web pages (HTML)
    -   Word documents
    -   PDF files
-   Presentations
    -   HTML
    -   PowerPoint
:::

::: {.column width="47%"}
-   Websites/blogs
-   Books
-   Dashboards
-   Interactive documents
-   Formatted journal articles
:::

Most RMarkdown documents readily render in Quarto

## Installation

- Quarto is a standalone app on your computer, not a R or Python package
- Installation instructions can be found here: [https://quarto.org/docs/get-started/](https://quarto.org/docs/get-started/)

![](./images/ch04/quarto-steps.png){width="80%" fig-align="center"}



## So we like Quarto?

- Keeping RMarkdown for lots of things, since it still works
- Ability to create Python-based documents (great for ML projects)
- Love some new things for presentations

::: {.notes}
The main story is that there is nothing wrong with either RMarkdown or Jupyter per se, but
Quarto enhances the feature set and gives Python a proper reproducible document tool. RMarkdown is still richer. 

The major enhancement over both is in creating presentations, and the ease of constructing 
particular layouts
:::


## Aside: Project website and presentation  

- It is a [COURSE REQUIREMENT]{.bloodred-bold}, that you build your website and presentation with Quarto
- It is [highly recommended]{.bloodred-bold} that use `.qmd` files and NOT `.ipynb` files for the website building.
  - However, it is easy to convert between the two formats by using the `quarto convert filename` command
- Functionally the two formats are basically identical, i.e. they're just `Markdown` + `Code` 
- However there is [ONE MAJOR DIFFERENCE]{.bloodred-bold}, i.e. `.ipynb` stores the code outputs in the meta-data of the file
  - This means you `ONLY HAVE TO RUN THE CODE ONCE` with `.ipynb`
  - `.qmd` will run the code every time you build the report, which can be very slow
    - There are `caching` options for `.qmd` to avoid this, however, they are "messier" that just using `.ipynb`
  - **Note**: If `.qmd` has no code, then it is basically just a `Markdown` file `.md`

# Using Quarto
Tour through various important quarto constructs 

## LaTex in quarto

- Since Quarto is built on top of Markdown, coding in Quarto should be pretty intuitive 

::: {.columns}
::: {.column}
### Quarto syntax

```
- This is an example of a bulleted list with math 
- Here is an in-line math equation $f(x)=\frac{e^{x^2}}{2}$

$$ g(x)=x^n \rightarrow \frac{\partial g}{\partial x}=n x^{n-1} $$

$$
\begin{align}
g(x)=x^n \rightarrow \frac{\partial g}{\partial x}=n x^{n-1}\\
h(x)=\int x^n dx \rightarrow h(x)=\frac{x^{n+1}}{n+1}
\end{align}
$$

```

:::
::: {.column}
### Result

- This is an example of a bulleted list with math 
- Here is an in-line math equation $f(x)=\frac{e^{x^2}}{2}$

$$ g(x)=x^n \rightarrow \frac{\partial g}{\partial x}=n x^{n-1} $$

$$
\begin{align}
g(x)=x^n \rightarrow \frac{\partial g}{\partial x}=n x^{n-1}\\
h(x)=\int x^n dx \rightarrow h(x)=\frac{x^{n+1}}{n+1}
\end{align}
$$

:::
:::

## Layouts  
 
- You can control basic layout options with `::: {layout-ncol=2}`

### Quarto syntax

````
::: {layout-ncol=2}
### List One

- Item A
- Item B


### List Two

- Item X
- Item Y

:::
````

### Result

:::: {.bordered}
::: {layout-ncol=2}
### List One

- Item A
- Item B


### List Two

- Item X
- Item Y

:::
::::

---


## Diagrams

Quarto has native support for embedding two popular diagram-generating tools:

- [Mermaid](https://mermaid-js.github.io/mermaid/#/) (`.mmd`)
- [Graphviz](https://graphviz.org/) (`.dot`)

```{mermaid}
%%| fig-cap: "A Mermaid diagram"
%%| echo: fenced
%%| code-fold: false
%%| output-location: column
flowchart LR
  A[Hard edge] --> B(Round edge)
  B --> C{Decision}
  C --> D[Result one]
  C --> E[Result two]
```

::: {.callout-note appearance="simple"}
- You can preview Mermaid (`.mmd`) and Graphviz (`.dot`) files both in RStudio (using the `DiagrammeR` package) and in VS Code (using the Quarto extension)
- For PDF and Word outputs, the diagrams are converted to PNG images using a native Chrome installation or the [Chromium] tool. 
:::

<!-- ::: {.notes}
One important thing to note here is that for Mermaid chunks, the chunk options are specified by `%%|` and not `#|` (R/Python) or `//|` (Javascript)
::: -->

## Creating figure layouts-1

### Quarto syntax

````
::: {layout-ncol=2}

![](./images/ch04/paste-CC007B93.png){fig-align="left" width="3.00in"}

![](./images/ch04/paste-0860D360.png){fig-align="left" width="3.00in"}

:::
````

### Result


::: {layout-ncol=2}

![](./images/ch04/paste-CC007B93.png){fig-align="left" width="3.00in"}

![](./images/ch04/paste-0860D360.png){fig-align="left" width="3.00in"}

:::

## Creating figure layouts-2

### Quarto syntax

- You can create arbitrary grid patterns for figure layouts

````
::: {layout="[[1], [1], [1],[1]]"}
![](./images/ch04/pdf.png){width=250}
![](./images/ch04/eqn.png){width=250}
![](./images/ch04/paste-0860D360.png){width=250}
![](./images/ch04/paste-0860D360.png){width=250}
:::
````

### Result

::: {layout="[[1], [1], [1],[1]]"}
![](./images/ch04/pdf.png){width=250}
![](./images/ch04/eqn.png){width=250}
![](./images/ch04/paste-0860D360.png){width=250}
![](./images/ch04/paste-0860D360.png){width=250}
:::


## Creating figure layouts-3 {.scrollable}

```{r}
#| layout-ncol: 2
#| fig-cap:
#|   - Speed and Stopping Distances of Cars
#|   - Vapor Pressure of Mercury as a Function of Temperature
#| echo: fenced
#| code-fold: false
#| vscode: {languageId: r}


plot(cars)
plot(pressure)
```

## Code highlighting

```{r}
#| layout-ncol: 2
#| label: fig-charts
#| fig-cap: Charts
#| fig-subcap:
#|   - Speed and Stopping Distances of Cars
#|   - Vapor Pressure of Mercury as a Function of Temperature
#| echo: fenced
#| code-fold: false
#| code-line-numbers: '|3|4-7'
#| vscode: {languageId: r}


plot(cars)
plot(pressure)
```

<!-- :::{.callout-note appearance="simple"}
You can use this same technique for any block-like element, not just figures. 
So you can use this for tables and lists, among others
:::

::: {.notes}
- Note that we have added a `label` to the options. This results in the captions being numbered
- We can specify sub-captions for each subfigure
:::
 -->

## Converting file types

* You can switch between `.qmd` and `.ipynb` with quarto 
  * `quarto convert clustering.qmd` this will output a `.ipynb` version called `clustering.ipynb`
  * `quarto convert eda.ipynb` this will output a `.qmd` version called `eda.qmd`
* **Examples**: 
  * `quarto convert filename.ipynb`
  * `quarto convert filename.qmd`
  * `quarto convert filename.rmd`
  * `quarto preview filename.qmd`
  * `quarto preview filename.ipynb`
  * `quarto render filename.qmd`
  * `quarto render filename.ipynb`

## Embedding video

{{{< video https://youtu.be/Z8t4k0Q8e8Y height="400" >}}}

{{< video https://youtu.be/Z8t4k0Q8e8Y height="400" >}}

[See [Quarto Videos](https://quarto.org/docs/authoring/videos.html) for more options and details]

## Aside: YAML overview 

* `Quarto` relies heavily on the `YAML format`
- [YAML (YAML Ain't Markup Language)]{.uured-bold}: A human-readable data serialization format.
- [Indentation]{.uured-bold}: Uses whitespace indentation (spaces or tabs) for structure, without relying on explicit delimiters like braces or brackets.
- [Key-Value Pairs]{.uured-bold}: Represents data as key-value pairs, e.g., `key: value`.
- [Lists]{.uured-bold}: Represents lists using hyphens, e.g., `- item1`, `- item2`.
- [Nested Structures]{.uured-bold}: Supports nested data structures using indentation.
- [Comments]{.uured-bold}: Allows comments with `#`.
- [Scalars]{.uured-bold}: Represents simple data types like strings, numbers, and booleans.
- [Data Types]{.uured-bold}: Supports various data types including strings, numbers, booleans, null, and dates.
- [Inclusion]{.uured-bold}: Permits the use of anchors and aliases for reusing data.
- [Readability]{.uured-bold}: Prioritizes human readability and is often used in configuration files and data exchange between languages.
- [No Code Execution]{.uured-bold}: YAML is not intended for executing code, making it safer than some other formats for data exchange.



## Aside: Tip for Mac users

* `command+control+shift+4` is very useful on a mac. 
  * It takes a screenshot and saves it to the clip-board
* Windows has a similar shortcut but you will have to google it 
* The following VSC extension allows you to paste images from the clip-board with `alt+command+v`.    
    ![](./images/ch04/2023-08-23-09-35-05.png){width=300}
* `tab` is your best friend when using the command line, since it does `auto-completion` 
* `open ./path_to_file` will open any file or directory from the command line  -->

# Citations and Bibliographies


## Citations

When creating documents, it is **imperative** that we properly cite and attribute sources we use in our document

- This is part of the Honor Code for academic integrity
- This is about being honest with intellectual property & giving credit where credit is due. 

> Keeping track of sources and citations often ends up being a **big deal**


## Reference management

There are several established reference managers available, both commercial and open-source. 

- Many of these can search online resources to add references and PDF
- Many have cloud storage allowing you to access your references from anywhere
- They can insert citations and create bibliographies in documents

--- 

## BibTeX

[BibTeX]() is a tool and file format that is used to describe and process lists of references. It was developed 
alongside LaTex. 

- BibTeX works especially well with the Markdown/Pandoc workflow of Quarto
   - It also works with Word using the [BibTeX4Word](http://www.ee.ic.ac.uk/hp/staff/dmb/perl/index.html) plugin

A typical BibTeX entry looks like this:

:::: {.columns}
::: {.column width="40%"}
```code
@article{article_key,
  author  = {Peter Adams}, 
  title   = {The title of the work},
  journal = {The name of the journal},
  year    = 1993,
  number  = 2,
  pages   = {201-213},
  month   = 7,
  note    = {An optional note}, 
  volume  = 4
}
```
:::
::: {.column width="55%"}
- The crucial piece in this entry is the `article_key` by which you will refer to the citation in your document
- There are [14 key BibTeX types](https://www.bibtex.com/e/entry-types/), but the most common are `@article`, `@book` and `@unpublished`
:::
::::

::: {.callout-important appearance="minimal"}
However, you **don't** need to write out these entries by hand
:::


## Reference managers

Several reference manages are available that provide citations in BibTeX format, among other formats

We tend to use two free managers: [Mendeley](https://www.mendeley.com) and [Zotero](https://www.zotero.org)

- Both store references in a single repository
- Both allow you to annotate PDFs and store them with the reference
- Both can import references from web pages using browser extensions
- Both can create a `.bib` file with references that can be used by Quarto 
- Both will create automatic citation keys for each reference

::: {.callout-note appearance='minimal'}
Zotero is one of the [citation tools](https://library.georgetown.edu/citations) recommended by GU
:::

To see some comparisons between these and a popular commercial reference manager, see [here](https://libguides.wustl.edu/BrownSchoolLibrary/citations)


## Citations in Quarto

There are a few citation formats that can be used with Quarto, through pandoc.

| **Format** | **File extension** |
| :--- | :--- |
| BibLaTeX | .bib |
| BibTeX | .bibtex |
| CSL JSON | .json |
| CSL YAML | .yaml |
| RIS | .ris |

::: {.callout-note appearance="simple" collapse="true"}
### Note

- The RIS format is available from many reference managers, including Endnote
- The CSL JSON format is also an available format from many reference managers
:::

Pandoc has the ability to automatically generate citations and a bibliography from BibTeX files and 
embedded references (much like we replace R/Python code with their output)


## Citations in Quarto

Point to `.bib` files in the YAML header, replacing the name w/ the file-name you're using

```
---
bibliography: references.bib
---
```

You can also specify a citation style (e.g., APA, MLA, Chicago) using the [Citation Style Language](https://citationstyles.org/),listed in the
[Zotero Style Repository](https://www.zotero.org/styles)

This can be specified in the YAML header as well

```
---
csl: nature.csl
---
```
You would need to download the `.csl` file from the repository and keep it in the same folder as your document.



## Citations in Quarto

You make a citation using the standard Pandoc/BibTeX syntax (`[@citation]`), where these are the citation-keys we saw before in the BibTeX entries.

- You can use multiple citations at a time, separated by semi-colons

![](./images/ch04/citations.png)


## Citations in Quarto

Pandoc will generate a bibliography and place it in the document. It will be placed in a div with the id `refs` if one exists, otherwise it will be place in the end of the document


```
### References

::: {#refs}
:::
```

Depending on the CSL format, the bibliography will conform to the ordering and format of that CSL specification. 

`Citation styles` 

::: {layout-ncol=3}

![American Statistical Association](./images/ch04/asa.png)

![Nature](./images/ch04/nature.png)

![Chicago](./images/ch04/chicago.png)

:::

<!-- 
## Citations in RStudio's visual editor

- Citations can be entered from your document bibliography (`.bib`) file, Zotero, DOI references or searches of [Crossref]( https://www.crossref.org/), [DataCite](https://datacite.org/) or [PubMed](https://pubmed.ncbi.nlm.nih.gov/)
- There is a "Insert Citation" dialog allowing you to run your searches of the bibliography file or other sources
- You can also add citations by starting typing `[@` and you can search your document bibliography for the right reference.  -->

# Supplementary material 

[Optional content]{.uugreen-bold}: Either cover quickly or skip, students can review at their pace.


## Using Quarto in RStudio

Given that Quarto is developed by Posit, the company behind RStudio, Quarto works 
quite seamlessly in RStudio

RStudio provides both a source editor and a *visual editor* experience for editing Quarto files

::: {.callout-caution appearance="minimal" collapse="true"}
The visual editor in RStudio does not work really well with more complex constructs like 
columns, callouts and tabsets. It tends to change the source code leading to problems
:::

![](https://quarto.org/docs/get-started/hello/images/rstudio-source-visual.png){width="60%" fig-align="center"}

## Using Quarto in RStudio

At the top of the file, we put an (optional) YAML header to provide information about 
document output, general formatting rules and the like.

````yaml
---
title: "Hello, Quarto"
format: html
editor: visual
---
````

- You can provide specifications for multiple output types in the same YAML header
   - The first one written is the one rendered by default

````yaml
---
title: "Hello, Quarto"
format:
   html: 
      theme: cerulean
      toc: true
      css: styles.css
   pdf: 
      toc: true
      number-sections: true
---
````

## Using Quarto in RStudio

- You can also specify the computational engine you want to use for the Quarto document in the YAML header (only if you're using a non-R engine via Jupyter)

````yaml
---
title: "Hello, Quarto"
format:
   html: 
      theme: cerulean
      toc: true
      css: styles.css
   pdf: 
      toc: true
      number-sections: true
jupyter: python3
---
````

You specify the Jupyter kernel you want to use as well

::: {.callout-important}
Note that YAML is a hierarchical specification with hierarchy denoted by indentation. This is important to maintain,
so your specification is clear. Note, for example, that the `jupyter` option is a top-level option, while the 
`html` and `pdf` specifications are within the `format` specification
:::

## Using Quarto in RStudio

Code is encapsulated in _code chunks_

::: {.columns}
::: {.column width="50%"}
### R

```{r}
#| label: load-packages-r
#| code-fold: false
#| echo: fenced

library(tidyverse)
```

You can also add code within the markdown sections, by using `r` or `python` syntax


> There are \`&#8203;r nrow(ggplot2::mpg)\` observations in our data 

results in 

> There are `r nrow(ggplot2::mpg)` observations in our data
:::

::: {.column width="50%"}

### Python

```{python}
#| label: load-packages-py
#| echo: fenced
#| code-fold: false
#| eval: false

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
```

To create "inline" code in Python use `python`
:::
:::

---


## Using Quarto in RStudio

You can add _snippets_ to the RStudio configuration. Thomas Mock provides several [useful Quarto snippets](https://gist.github.com/jthomasmock/11acebd4448f171f786e01397df34116?permalink_comment_id=4269591#file-markdown-snippets)

::: {layout-ncol=2 }
![](./images/ch04/snippets1.png){width="60%" fig-align="center"} 

![](./images/ch04/snippets2.png){width="80%" fig-align="center"}

:::

## Using Quarto in RStudio

You can run individual chunks in the R session

![](https://quarto.org/docs/get-started/hello/images/rstudio-inline-output.png)

## Using Quarto in RStudio

You can render Quarto documents from the menu:

![](https://quarto.org/docs/get-started/hello/images/rstudio-render.png)

or from the {{< fa brands r-project >}} Console

```{r}
#| eval: false
#| echo: true
#install.packages("quarto")
quarto::quarto_render("hello.qmd")
```

::: {.callout-tip appearance="simple"}
You can use the R Console regardless of whether you're running a {{< fa brands r-project >}} or {{< fa brands python >}}  Quarto document

:::

## Using Quarto in Visual Studio Code

Quarto in VS Code works much like in RStudio, with some differences.

- Install the [Quarto VS Code Extension](https://marketplace.visualstudio.com/items?itemName=quarto.quarto) which provides several usability enhancements for Quarto documents
- VS Code tends to work better when using the Jupyter engines
- Running individual code chunks is a little different, using the `Run cell` button above the code cell

![](https://quarto.org/docs/tools/images/vscode-execute-cell.png)

## Using Quarto in Visual Studio Code

- You can also render a document using the `Preview` button at the top right of the editor

![](https://quarto.org/docs/tools/images/vscode-preview-button.png)

- A set of useful snippets, and instructions for installing them, are [here](https://gist.github.com/jthomasmock/11acebd4448f171f786e01397df34116?permalink_comment_id=4269591#gistcomment-4269591)

## Using Quarto in JupyterLab

The basic Quarto document structure is retained in JupyterLab within a `ipynb` file

- You create Markdown and Code cells just as you're used to in Jupyter notebooks
- For the YAML header, you use a "Raw" cell, rather than a Markdown cell
- You can use YAML comments in Code cells for cell options

::: {.fragment}
But rendering is different

- Open a Terminal in JupyterLab
- Render documents via the command line

```code
quarto render hello.ipynb --to html
quarto render hello.ipynb --to docx
```
:::
::: {.fragment}
If you just want a live preview of the notebook (for development), so you can see updates and errors "on the fly":

```code
quarto preview hello.ipynb --to html
```
:::

---

## Using Quarto in JupyterLab {#sec-convert}

- Quarto does not execute the `.ipynb` cells while render the notebook again
  - Cell outputs are cached in a Jupyter notebook, and so *you will get what you see*
   - If you want to execute the cells upon rendering, add a `--execute` flag

```code
quarto render hello.ipynb --execute
```
  - or add to the YAML header
   
````code
---
execute:
      enabled: true
---
````
   
- You can convert between a `ipynb` notebook and a text-based `qmd` file
  - You can use the [Jupytext](https://jupytext.readthedocs.io/en/latest/) package to maintain parallel synchronized version of `.qmd` and `.ipynb` files

```code
quarto convert hello.ipynb # converts to qmd
quarto convert hello.qmd   # converts to ipynb 
```


---

## Rendering Quarto documents

::: {.callout-important}
This section is specific to our class setup and workflows and is applicable more generally
:::

We use `conda` virtual environments in our workflows. These require some special treatment

- There is a Posit-preferred way described [here](https://quarto.org/docs/projects/virtual-environments.html) that requires you to have the virtual environment in the same folder as your project
- We have found that a better option is to use the command line!!
   - Open terminal & activate the virtual environment: `conda activate anly503`
   - Render/preview the Quarto document from the command line

```code
quarto render document.qmd --to html
quarto render document.ipynb --to html
```

::: {.callout-warning appearance='minimal'}
Make sure you have the right path to the `.qmd` document relative to where you're running the terminal
:::




## Multilingual documents

You can use **both** {{< fa brands r-project >}} and {{< fa brands python >}} in the same document!!!

- You should use the `knitr` engine
- Add the following chunk as the first chunk in your document

```{r}
#| echo: true
#| eval: false

library(reticulate)
# reticulate::use_condaenv('aba688')

```

- The R engine will then use the `anly503` conda environment for all Python chunks. 
   - It will also run all the chunks in the same Python instance, so you can pass data from one chunk to the next
   
::: {.callout-note appearance='simple'}
The Jupyter engine does not allow multipe engines to run concurrently, so rendering both R and Python chunks in the same Jupyter document doesn't work
:::

## Tangling {#sec-tangle}

Sometimes it is useful to extract the actual code from the Quarto document so that it can just run without the overhead 
of processing the full document or noteboook. This is called [**tangling**](#sec-rd)

- This feature is currently not implemented in Quarto :frowning:
- For R/`knitr`-based quarto documents, one can use `knitr::purl`

```{r}
#| echo: true
#| eval: false
knitr::purl("mydocument.qmd")
```

will result in creating `mydocument.R`, where the markdown are placed in comments. 

- For Python/Jupyter, open the document in Jupyter (after [converting](#sec-convert) it to `.ipynb` if needed) and then do one of the following:
    - Convert from the GUI, using `File -> Download as -> Python (.py)`
    - Use the command line: `jupyter nbconvert --to python notebook.ipynb`
    - Use `jupytext` to sync the `.ipynb` file with a `.py` file (see [here]()) 

## Summary

- Quarto is a new document creation system that is built on top of Markdown
- It is designed to be more flexible and extensible than RMarkdown
- It can use R, Python and Jupyter kernels
- It can create a wide variety of document types
